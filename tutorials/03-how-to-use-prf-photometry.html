
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>How to perform PRF photometry? &#8212; Lightkurve</title>
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <!-- Load Bootstrap CSS and Javascript (Javascript is needed for the navbar toggle) -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

    <!-- Load the theme's CSS. -->
    <link rel="stylesheet" href="../_static/css/amunra.css" type="text/css" />

    
      <!-- Google Analytics -->
      <script async src="https://www.googletagmanager.com/gtag/js?id=UA-69171-9"></script>
      <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-69171-9');
      </script>
    

  </head><body>
<header>
<nav class="navbar navbar-expand-lg navbar-light border-bottom">
  <div class="container">
    <a class="navbar-brand" href="../index.html">Lightkurve v1.1</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample07" aria-controls="navbarsExample07" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarsExample07">

    
      <!-- Custom navbar -->
      <ul class="navbar-nav mr-auto">
          
          <li class="nav-item">
          
            <a class="nav-link" href="../quickstart.html">Quickstart</a>
          </li>
          
          <li class="nav-item">
          
            <a class="nav-link" href="index.html">Tutorials</a>
          </li>
          
          <li class="nav-item">
          
            <a class="nav-link" href="../api/index.html">API</a>
          </li>
          
          <li class="nav-item">
          
            <a class="nav-link" href="../about/index.html">About</a>
          </li>
      </ul>
    

        <form class="form-inline my-2 my-md-0 ml-auto" action="../search.html" method="get">
            <input class="form-control" type="text" placeholder="Search" aria-label="Search" name="q" />
        </form>

        <!-- GitHub icon -->
        
          <a href="https://github.com/KeplerGO/Lightkurve">
            <svg class="github-icon" viewBox="0 0 16 16" version="1.1" height="22" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg>
          </a>
        
    </div>
  </div>
</nav>
</header>

<div class="container">
    
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 7ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    background: #f5f5f5;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div style="float:right; margin-top:1em; margin-bottom:-1em;">
    <a href="https://github.com/KeplerGO/lightkurve/tree/master/docs/source/tutorials/03-how-to-use-prf-photometry.ipynb"><img src="https://img.shields.io/badge/Jupyter%20Notebook-Download-blue.svg"></a>
    <a href=" https://colab.research.google.com/github/KeplerGO/lightkurve/blob/master/docs/source/tutorials/03-how-to-use-prf-photometry.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg"></a>
    <a href="https://mybinder.org/v2/gh/KeplerGO/lightkurve/master?filepath=docs/source/tutorials/03-how-to-use-prf-photometry.ipynb"><img alt="Binder badge" src="https://mybinder.org/badge_logo.svg"></a>
</div>
<br style="clear:both;"><div class="section" id="How-to-perform-PRF-photometry?">
<h1>How to perform PRF photometry?<a class="headerlink" href="#How-to-perform-PRF-photometry?" title="Permalink to this headline">¶</a></h1>
<p>In previous tutorials we discussed <a class="reference external" href="1.03-what-are-lightcurves.html">how aperture photometry works</a> and how you can <a class="reference external" href="2.05-making-custom-apertures.html">create your own custom masks</a> to extract aperture photometry.</p>
<p>As a reminder, aperture photometry works by summing up the flux values across all the pixels in a pre-defined mask. It tends to offer the fastest and most robust way to extract photometry for an isolated star, but it suffers from the three limitations: 1. When two or more stars overlap, aperture photometry will return the sum of the flux of all stars. Separating their signals requires additional assumptions. 2. When the telescope experience motion or focus changes, the fraction of the flux of a
star captured by the pre-defined aperture mask will change. This imposes systematics on the data which need to be removed (e.g. using the CBV or SFF techniques). 3. It may be difficult to separate a background signal from the lightcurve of a star. In particular, this is a concern when time-varying background signals are present, such as the so-called “rolling bands” in Kepler.</p>
<p>An alternative to aperture photometry which addresses the above limitations is called called <em>Point Response Function (PRF) model fitting photometry</em>, also known as <em>Point Spread Function (PSF) fitting photometry</em> or <em>PRF (PSF) photometry</em> in short. In this method, a parameterized model is fit to the data. This method is significantly more complicated then aperture photometry and is prone to a different set of systematics. However it offers the ability to separate the signals of overlapping
stars in very crowded regions or star clusters.</p>
<p>This tutorial demonstrates how <em>lightkurve</em> can be used to extract lightcurves using the model fitting technique. We will start with an easy example and then show how you can tune the parameters of the model to create more careful analyses.</p>
<div class="section" id="Table-of-contents">
<h2>Table of contents<a class="headerlink" href="#Table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>Simple example: PRF photometry of Kepler-10</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</p></li>
<li><p>Visualizing and fitting a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</p></li>
<li><p>Changing <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> priors</p></li>
<li><p>Creating lightcurves with a custom <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</p></li>
</ol>
</div>
<div class="section" id="Simple-example:-PRF-photometry-of-Kepler-10">
<h2>Simple example: PRF photometry of Kepler-10<a class="headerlink" href="#Simple-example:-PRF-photometry-of-Kepler-10" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with a simple example by obtaining PRF photometry for planet system <em>Kepler-10</em>. We start by downloading the pixel data from the archive:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="s2">&quot;Kepler-10&quot;</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">quality_bitmask</span><span class="o">=</span><span class="s1">&#39;hardest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The easiest way to get PRF photometry is to simply call the <code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code> method with parameter <code class="docutils literal notranslate"><span class="pre">method='prf'</span></code>. This will fit the pixel data of all cadences with a default model and return the lightcurve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;prf&#39;</span><span class="p">)</span>
<span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Warning: PRF-fitting photometry is experimental in this version of lightkurve.
Fitting cadences: 100%|██████████| 3634/3634 [00:40&lt;00:00, 89.59it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c20b4d940&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_3_2.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_3_2.png" src="../_images/tutorials_03-how-to-use-prf-photometry_3_2.png" style="width: 755px; height: 369px;" /></a>
</div>
</div>
<p>A good way to verify that the model-fitting photometry produced a sensible output is by comparing it against standard aperture photometry. You can obtain aperture photometry using the same <code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code> method and the parameter <code class="docutils literal notranslate"><span class="pre">method='aperture'</span></code> (which is the default value of this parameter).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc_aper</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;aperture&#39;</span><span class="p">)</span>
<span class="n">lc_aper</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c24abf470&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_5_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_5_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_5_1.png" style="width: 755px; height: 368px;" /></a>
</div>
</div>
<p>There is a notable difference in the long-term trend in both lightcurves. This is because PRF-fitting photometry yields a local estimate of the background which is often different from the Kepler pipeline’s global background level estimates.</p>
<p>Let’s fold both lightcurves on the period of the known planet <em>Kepler-10 b</em> to show that the transit can be recovered equally well:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PRF photometry&#39;</span><span class="p">)</span>
<span class="n">lc</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.8376</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Aperture photometry&#39;</span><span class="p">)</span>
<span class="n">lc_aper</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.8376</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c23884b70&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_7_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_7_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_7_1.png" style="width: 861px; height: 277px;" /></a>
</div>
</div>
<p>Success! Note that the outliers between <em>phase</em> -0.4 and 0.0 are caused by the transits of another planet with a different period.</p>
<p>Note that PRF photometry appears to offer a few percent less noise compared to its aperture counterpart:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The CDPP noise metric equals:</span>
<span class="si">{:.1f}</span><span class="s2"> ppm for PRF-fitting photometry;</span>
<span class="si">{:.1f}</span><span class="s2"> ppm for aperture photometry.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">(),</span> <span class="n">lc_aper</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The CDPP noise metric equals:
48.6 ppm for PRF-fitting photometry;
33.4 ppm for aperture photometry.
</pre></div></div>
</div>
<p>This is all you need to know to get started with PRF photometry! In what follows, we explain how you can tune the parameters of the model fitting.</p>
</div>
<div class="section" id="The-TPFModel-object">
<h2>The <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#The-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>It is often possible to obtain better results by carefully tuning the model that is being fit to the data. This is true in particular when the data contain multiple overlapping stars. Let’s have a look at how you can interact and change the model.</p>
<p><em>Lightkurve</em> uses objects of type <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> to specify the model. You can obtain the default model using the <code class="docutils literal notranslate"><span class="pre">get_model()</span></code> method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
<span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>lightkurve.prf.tpfmodel.TPFModel
</pre></div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object encapsulates our beliefs about the stars contained in a pixel file. The key parameters are:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">model.star_priors</span></code> captures our prior beliefs about the positions and fluxes of the point sources in the data using a list of <code class="docutils literal notranslate"><span class="pre">StarPrior</span></code> objects. Each <code class="docutils literal notranslate"><span class="pre">StarPrior</span></code> object is parameterized by <code class="docutils literal notranslate"><span class="pre">col</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code> in pixel coordinates and <code class="docutils literal notranslate"><span class="pre">flux</span></code> in electrons/second;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.background_prior</span></code> captures our beliefs about the per-pixel background, parameterized by <code class="docutils literal notranslate"><span class="pre">flux</span></code> in electrons/second;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.focus_prior</span></code> captures our beliefs on the focus of the spacecraft, parameterized by the unit-less stretch factors <code class="docutils literal notranslate"><span class="pre">scale_col</span></code> and <code class="docutils literal notranslate"><span class="pre">scale_row</span></code>, and <code class="docutils literal notranslate"><span class="pre">rotation_angle</span></code> in radians;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.motion_prior</span></code> captures our beliefs about spacecraft motion, parameterized by <code class="docutils literal notranslate"><span class="pre">shift_col</span></code> and <code class="docutils literal notranslate"><span class="pre">shift_row</span></code> in pixel coordinates;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.prfmodel</span></code> an object of type <code class="docutils literal notranslate"><span class="pre">KeplerPRF</span></code> which models the Point Response Function.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">model.fit_background</span></code>, <code class="docutils literal notranslate"><span class="pre">model.fit_focus</span></code>, and <code class="docutils literal notranslate"><span class="pre">model.fit_motion</span></code> are booleans which indicate whether or not the background, focus, and motion parameters should be considered free parameters, i.e. whether or not our beliefs should assumed to be perfect.</p></li>
</ul>
<p>The parameters of each of these components are prior distributions.</p>
<p>We can inspect the our beliefs by accessing the properties, for example, this is the prior on the column pixel coordinate of the star in our data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">star_priors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;GaussianPrior(mean=[655.70045778], var=[0.00046541])&gt;
</pre></div>
</div>
</div>
<p>And this is the model’s prior on the background flux:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">background_prior</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;GaussianPrior(mean=[138.52747], var=[145.87004587])&gt;
</pre></div>
</div>
</div>
<p>We can inspect all the parameters at once using the <code class="docutils literal notranslate"><span class="pre">print</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;lightkurve.prf.tpfmodel.TPFModel object at 0x1c238c50b8&gt;
  &lt;StarPrior(
    col=&lt;GaussianPrior(mean=[655.70045778], var=[0.00046541])&gt;
    row=&lt;GaussianPrior(mean=[246.83753465], var=[0.0007464])&gt;
    flux=&lt;UniformPrior(lb=[83941.5390625], ub=[1066484.375])&gt;
    targetid=11904151)&gt;
  &lt;BackgroundPrior(
    flux=&lt;GaussianPrior(mean=[138.52747], var=[145.87004587])&gt;)&gt;
  &lt;FocusPrior(
    scale_col=&lt;GaussianPrior(mean=[1], var=[0.0001])&gt;
    scale_row=&lt;GaussianPrior(mean=[1], var=[0.0001])&gt;
    rotation_angle=&lt;UniformPrior(lb=[-3.1415], ub=[3.1415])&gt;)&gt;
  &lt;MotionPrior(
    shift_col=&lt;GaussianPrior(mean=[0], var=[1.])&gt;
    shift_row=&lt;GaussianPrior(mean=[0], var=[1.])&gt;)&gt;
  &lt;lightkurve.prf.prfmodel.KeplerPRF object at 0x1c238c5b38&gt;
  fit_background=True
  fit_focus=False
  fit_motion=False

</pre></div></div>
</div>
</div>
<div class="section" id="Visualizing-and-fitting-a-TPFModel-object">
<h2>Visualizing and fitting a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#Visualizing-and-fitting-a-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object contains several methods to interact with the model. For example, you can visualize the default prediction using the <code class="docutils literal notranslate"><span class="pre">plot()</span></code> method. This will visualize the model prediction using the prior means. Let’s plot the model below (left panel) and compare it against the observed data (right panel):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_20_0.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_20_0.png" src="../_images/tutorials_03-how-to-use-prf-photometry_20_0.png" style="width: 812px; height: 285px;" /></a>
</div>
</div>
<p>You can fit the model to a single cadence of pixel data using the <code class="docutils literal notranslate"><span class="pre">fit()</span></code> method, which returns an object of type <code class="docutils literal notranslate"><span class="pre">TPFModelParameters</span></code> which encapulsates the maximum likelihood values of the parameters for that cadence:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;lightkurve.prf.tpfmodel.TPFModelParameters object at 0x1c237d66a0&gt;
  &lt;StarParameters(
    col=655.6409995230879
    row=246.75968144624395
    flux=528783.6252248927
    targetid=None)&gt;
  &lt;BackgroundParameters(
    flux=175.21544001684765
    fitted=True)&gt;
  &lt;FocusParameters(
    scale_col=[1]
    scale_row=[1]
    rotation_angle=[0.]
    fitted=False)&gt;
  &lt;MotionParameters(
    shift_col=[0]
    shift_row=[0]
    fitted=False)&gt;
  residual_image:
    [ 13.54472234 -24.96701167 -36.46893428 -36.42862056...
  predicted_image:
    [175.21544002 175.21544002 175.21544002 175.21544002...

</pre></div></div>
</div>
<p>For example, we can access the maximum likelihood value of the stellar flux as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span><span class="o">.</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>528783.6252248927
</pre></div>
</div>
</div>
<p>And the background flux was found to be:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>175.21544001684765
</pre></div>
</div>
</div>
<p>We can visualize the model again, this time passing the fitted parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c236f34a8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_28_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_28_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_28_1.png" style="width: 748px; height: 285px;" /></a>
</div>
</div>
</div>
<div class="section" id="Changing-TPFModel-priors">
<h2>Changing <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> priors<a class="headerlink" href="#Changing-TPFModel-priors" title="Permalink to this headline">¶</a></h2>
<p>We can change a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> by manipulating its properties. For example, we can add a star to the lower right corner of the pixel file as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">StarPrior</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">star_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="mi">660</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">243</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="mf">1e6</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_31_0.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_31_0.png" src="../_images/tutorials_03-how-to-use-prf-photometry_31_0.png" style="width: 382px; height: 277px;" /></a>
</div>
</div>
<p>Alternatively, you can build a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> from scratch. In the example below, we use an arbitrary combination of Gaussian, Uniform, and Fixed priors to initialize a model. Note that the ideal choices for these assumptions depend strongly on your scientific objectives and may require trial-and-error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">TPFModel</span><span class="p">,</span> <span class="n">StarPrior</span><span class="p">,</span> <span class="n">BackgroundPrior</span><span class="p">,</span> <span class="n">FocusPrior</span><span class="p">,</span> <span class="n">MotionPrior</span>
<span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">GaussianPrior</span><span class="p">,</span> <span class="n">UniformPrior</span><span class="p">,</span> <span class="n">FixedValuePrior</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TPFModel</span><span class="p">(</span><span class="n">star_priors</span><span class="o">=</span><span class="p">[</span><span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">656</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">247</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">flux</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)),</span>
                              <span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">FixedValuePrior</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">660</span><span class="p">),</span>
                                        <span class="n">row</span><span class="o">=</span><span class="n">FixedValuePrior</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">243</span><span class="p">),</span>
                                        <span class="n">flux</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1e7</span><span class="p">))],</span>
                 <span class="n">background_prior</span><span class="o">=</span><span class="n">BackgroundPrior</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">10.</span><span class="p">)),</span>
                 <span class="n">focus_prior</span><span class="o">=</span><span class="n">FocusPrior</span><span class="p">(</span><span class="n">scale_col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
                                        <span class="n">scale_row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
                                        <span class="n">rotation_angle</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=-</span><span class="mf">3.1415</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">3.1415</span><span class="p">)),</span>
                 <span class="n">motion_prior</span><span class="o">=</span><span class="n">MotionPrior</span><span class="p">(</span><span class="n">shift_col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
                                          <span class="n">shift_row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)),</span>
                 <span class="n">prfmodel</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">get_prf_model</span><span class="p">(),</span>
                 <span class="n">fit_background</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">fit_focus</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fit_motion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_33_0.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_33_0.png" src="../_images/tutorials_03-how-to-use-prf-photometry_33_0.png" style="width: 388px; height: 277px;" /></a>
</div>
</div>
</div>
<div class="section" id="Creating-lightcurves-with-a-custom-TPFModel-object">
<h2>Creating lightcurves with a custom <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#Creating-lightcurves-with-a-custom-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>Above we demonstrated how you can interact with a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> and fit its parameters to a single cadence. Most users will be interested in obtaining a lightcurve by fitting the model to <em>all</em> the cadences rather than a single one.</p>
<p>To make this easy, <em>lightkurve</em> provides a helper class called <code class="docutils literal notranslate"><span class="pre">PRFPhotometry</span></code>, which makes it easy to fit the model to all cadences and inspect the results. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve</span> <span class="k">import</span> <span class="n">PRFPhotometry</span>
<span class="n">prfphot</span> <span class="o">=</span> <span class="n">PRFPhotometry</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">)</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Fitting cadences: 100%|██████████| 3634/3634 [00:40&lt;00:00, 89.26it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_36_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_36_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_36_1.png" style="width: 424px; height: 684px;" /></a>
</div>
</div>
<p>You can access the details of the fit in each cadence using the <code class="docutils literal notranslate"><span class="pre">prfphot.results</span></code> property, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>528783.6252248927
</pre></div>
</div>
</div>
<p>Alternative, you can access the fitted fluxes as a <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code> object:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">lightcurves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;lightkurve.lightcurve.LightCurve at 0x1c24883278&gt;
</pre></div>
</div>
</div>
<p>Note that the focus and motion parameters in the example above are constant. This is because the <code class="docutils literal notranslate"><span class="pre">fit_focus</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_motion</span></code> parameters were set to <code class="docutils literal notranslate"><span class="pre">False</span></code> in the model. By setting these to <code class="docutils literal notranslate"><span class="pre">True</span></code>, we can potentially improve the quality of the fit. Beware however, this comes at the cost of slowing down the fitting process and potentially introducing more complicated systematics and parameter degeneracies.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit_focus</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit_motion</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">)</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Fitting cadences: 100%|██████████| 3634/3634 [02:17&lt;00:00, 26.47it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_42_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_42_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_42_1.png" style="width: 424px; height: 684px;" /></a>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">lightcurves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x1c249a39e8&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<a class="reference internal image-reference" href="../_images/tutorials_03-how-to-use-prf-photometry_43_1.png"><img alt="../_images/tutorials_03-how-to-use-prf-photometry_43_1.png" src="../_images/tutorials_03-how-to-use-prf-photometry_43_1.png" style="width: 755px; height: 368px;" /></a>
</div>
</div>
<p>Uhoh, the increased model flexibility introduced complicated systematics. These systematics are caused in part by the degeneracy between the star’s <code class="docutils literal notranslate"><span class="pre">col</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code> position and the <code class="docutils literal notranslate"><span class="pre">shift_col</span></code> and <code class="docutils literal notranslate"><span class="pre">shift_row</span></code> parameters. The degeneracy will disappear when additional stars are present in the data, or when tighter priors are employed.</p>
</div>
<div class="section" id="Comments?">
<h2>Comments?<a class="headerlink" href="#Comments?" title="Permalink to this headline">¶</a></h2>
<p>At present we are evaluating the design and use of <em>lightkurve</em>’s PRF photometry for use in crowded fields. If you encounter issues, or would like to contribute a tutorial or working example, then please open an issue or pull request on GitHub!</p>
</div>
</div>


</div>
<div class="container footer">
    <hr>
    <p class="text-center">
      
        Created with ♥ by the Lightkurve collaboration.
                      Please <a href="about/citing.html">cite us</a> or
                      <a href="https://github.com/KeplerGO/Lightkurve">join us on GitHub.</a>
      
    </p>
</div>
  </body>
</html>